import { StateData, StateFlag } from '../../src/remote/ojremotes';

test('StateData', () => {

    const json = '{"jobState":{"name":"EXCEPTION","flags":["EXCEPTION"]},"date":"Oct 5, 2020 9:53:12 AM","throwable":{"originalExcpetionClassName":"java.lang.RuntimeException","detailMessage":"Ahhh!","stackTrace":[{"declaringClass":"org.oddjob.web.gson.HandlerTypesAsJsonTest","methodName":"testStateful","fileName":"HandlerTypesAsJsonTest.java","lineNumber":44},{"declaringClass":"sun.reflect.NativeMethodAccessorImpl","methodName":"invoke0","fileName":"NativeMethodAccessorImpl.java","lineNumber":-2},{"declaringClass":"sun.reflect.NativeMethodAccessorImpl","methodName":"invoke","fileName":"NativeMethodAccessorImpl.java","lineNumber":62},{"declaringClass":"sun.reflect.DelegatingMethodAccessorImpl","methodName":"invoke","fileName":"DelegatingMethodAccessorImpl.java","lineNumber":43},{"declaringClass":"java.lang.reflect.Method","methodName":"invoke","fileName":"Method.java","lineNumber":498},{"declaringClass":"org.junit.runners.model.FrameworkMethod$1","methodName":"runReflectiveCall","fileName":"FrameworkMethod.java","lineNumber":50},{"declaringClass":"org.junit.internal.runners.model.ReflectiveCallable","methodName":"run","fileName":"ReflectiveCallable.java","lineNumber":12},{"declaringClass":"org.junit.runners.model.FrameworkMethod","methodName":"invokeExplosively","fileName":"FrameworkMethod.java","lineNumber":47},{"declaringClass":"org.junit.internal.runners.statements.InvokeMethod","methodName":"evaluate","fileName":"InvokeMethod.java","lineNumber":17},{"declaringClass":"org.junit.runners.ParentRunner","methodName":"runLeaf","fileName":"ParentRunner.java","lineNumber":325},{"declaringClass":"org.junit.runners.BlockJUnit4ClassRunner","methodName":"runChild","fileName":"BlockJUnit4ClassRunner.java","lineNumber":78},{"declaringClass":"org.junit.runners.BlockJUnit4ClassRunner","methodName":"runChild","fileName":"BlockJUnit4ClassRunner.java","lineNumber":57},{"declaringClass":"org.junit.runners.ParentRunner$3","methodName":"run","fileName":"ParentRunner.java","lineNumber":290},{"declaringClass":"org.junit.runners.ParentRunner$1","methodName":"schedule","fileName":"ParentRunner.java","lineNumber":71},{"declaringClass":"org.junit.runners.ParentRunner","methodName":"runChildren","fileName":"ParentRunner.java","lineNumber":288},{"declaringClass":"org.junit.runners.ParentRunner","methodName":"access$000","fileName":"ParentRunner.java","lineNumber":58},{"declaringClass":"org.junit.runners.ParentRunner$2","methodName":"evaluate","fileName":"ParentRunner.java","lineNumber":268},{"declaringClass":"org.junit.runners.ParentRunner","methodName":"run","fileName":"ParentRunner.java","lineNumber":363},{"declaringClass":"org.junit.runner.JUnitCore","methodName":"run","fileName":"JUnitCore.java","lineNumber":137},{"declaringClass":"com.intellij.junit4.JUnit4IdeaTestRunner","methodName":"startRunnerWithArgs","fileName":"JUnit4IdeaTestRunner.java","lineNumber":69},{"declaringClass":"com.intellij.rt.junit.IdeaTestRunner$Repeater","methodName":"startRunnerWithArgs","fileName":"IdeaTestRunner.java","lineNumber":33},{"declaringClass":"com.intellij.rt.junit.JUnitStarter","methodName":"prepareStreamsAndStart","fileName":"JUnitStarter.java","lineNumber":220},{"declaringClass":"com.intellij.rt.junit.JUnitStarter","methodName":"main","fileName":"JUnitStarter.java","lineNumber":53}],"suppressedExceptions":[]}}';

    const obj = JSON.parse(json)
    const stateData = new StateData(obj.jobState, new Date(obj.date), obj.throwable);

    expect(stateData.jobState.name).toBe("EXCEPTION");
    expect(stateData.jobState.flags[0]).toBe(StateFlag.EXCEPTION);

    expect(stateData.date).toStrictEqual(new Date("Oct 5, 2020 9:53:12 AM"));

});